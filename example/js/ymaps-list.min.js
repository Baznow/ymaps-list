"use strict";!function(t,o,e){function i(){return"function"!=typeof o.createElement?o.createElement(arguments[0]):c?o.createElementNS.call(o,"http://www.w3.org/2000/svg",arguments[0]):o.createElement.apply(o,arguments)}var s=[],a={_version:"3.5.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(t,o){var e=this;setTimeout(function(){o(e[t])},0)},addTest:function(t,o,e){s.push({name:t,fn:o,options:e})},addAsyncTest:function(t){s.push({name:null,fn:t})}},n=function(){};n.prototype=a,n=new n;var l=[],r=a._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];a._prefixes=r;var p=o.documentElement,c="svg"===p.nodeName.toLowerCase(),h=a.testStyles=function(t,e,s,a){var n,l,r,h,m,d="modernizr",u=i("div"),f=((m=o.body)||((m=i(c?"svg":"body")).fake=!0),m);if(parseInt(s,10))for(;s--;)(r=i("div")).id=a?a[s]:d+(s+1),u.appendChild(r);return(n=i("style")).type="text/css",n.id="s"+d,(f.fake?f:u).appendChild(n),f.appendChild(u),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(o.createTextNode(t)),u.id=d,f.fake&&(f.style.background="",f.style.overflow="hidden",h=p.style.overflow,p.style.overflow="hidden",p.appendChild(f)),l=e(u,t),f.fake?(f.parentNode.removeChild(f),p.style.overflow=h,p.offsetHeight):u.parentNode.removeChild(u),!!l};n.addTest("touchevents",function(){var e;if("ontouchstart"in t||t.DocumentTouch&&o instanceof DocumentTouch)e=!0;else{var i=["@media (",r.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");h(i,function(t){e=9===t.offsetTop})}return e}),function(){var t,o,e,i,a,r;for(var p in s)if(s.hasOwnProperty(p)){if(t=[],(o=s[p]).name&&(t.push(o.name.toLowerCase()),o.options&&o.options.aliases&&o.options.aliases.length))for(e=0;e<o.options.aliases.length;e++)t.push(o.options.aliases[e].toLowerCase());for(i="function"==typeof o.fn?o.fn():o.fn,a=0;a<t.length;a++)1===(r=t[a].split(".")).length?n[r[0]]=i:(!n[r[0]]||n[r[0]]instanceof Boolean||(n[r[0]]=new Boolean(n[r[0]])),n[r[0]][r[1]]=i),l.push((i?"":"no-")+r.join("-"))}}(),delete a.addTest,delete a.addAsyncTest;for(var m=0;m<n._q.length;m++)n._q[m]();t.Modernizr=n}(window,document);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,o){for(var e=0;e<o.length;e++){var i=o[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(o,e,i){return e&&t(o.prototype,e),i&&t(o,i),o}}();function _classCallCheck(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}var Ylist=function(){function t(o){_classCallCheck(this,t),this.options=o,this.map=null,o.hasOwnProperty("data")?this.points=this.options.data:this.points=null,this.placemarks=[],this.activePlacemark=null,this.activeListItem=null,this.clusterer=null,this.balloonLayout=null,this.balloonParams={balloonWidth:null,balloonHeight:null,balloonTailHeight:15},this.listClassName="ylist-list",this.touch=!!Modernizr.touchevents,this.isLessThanAdaptiveBreakpoint=!1,this.mqlAdaptiveBreakpoint=window.matchMedia("(max-width: "+(this.options.adaptiveBreakpoint-1)+"px)"),this.needReloadMap=!0,this.currentFilterCallback=null,this.currentFilterParam=null}return _createClass(t,[{key:"init",value:function(){this._checkRequiredOptions();var t=this;ymaps.ready(function(){t.mqlAdaptiveBreakpoint.addListener(function(){t._adaptiveHandle(this,t)}),t._adaptiveHandle(t.mqlAdaptiveBreakpoint,t)}),this.options.list.active&&this._initList()}},{key:"_checkRequiredOptions",value:function(){if(!this.points)throw new Error("You need to JSON data");if(!this.options.hasOwnProperty("dataOrder")||this.options.hasOwnProperty("dataOrder")&&0==this.options.dataOrder.length)throw new Error("You need to set dataOrder option");if(this.options.hasOwnProperty("dataExtension")||(this.options.dataExtension={}),!this.options.hasOwnProperty("container"))throw new Error("You need to set container option");if(this.options.hasOwnProperty("map")||(this.options.map={}),this.options.hasOwnProperty("map")&&"object"==_typeof(this.options.map)){if(!this.options.map.hasOwnProperty("center"))throw new Error("You need to set map.center option");if(!this.options.map.hasOwnProperty("container"))throw new Error("You need to set map.container option");this.options.map.hasOwnProperty("customize")||(this.options.map.customize=!1),this.options.map.hasOwnProperty("customize")&&"object"==_typeof(this.options.map.customize)&&(this.options.map.customize.hasOwnProperty("state")||(this.options.map.customize.state=!1),this.options.map.customize.hasOwnProperty("options")||(this.options.map.customize.options={}),this.options.map.customize.hasOwnProperty("controls")||(this.options.map.customize.controls=!1)),this.options.map.hasOwnProperty("drag")||(this.options.map.drag={}),this.options.map.hasOwnProperty("drag")&&"object"==_typeof(this.options.map.drag)&&(this.options.map.drag.hasOwnProperty("disableOnTouch")||(this.options.map.drag.disableOnTouch=!0),this.options.map.drag.hasOwnProperty("disableAlways")||(this.options.map.drag.disableAlways=!1)),this.options.map.hasOwnProperty("dragTooltip")||(this.options.map.dragTooltip={}),this.options.map.hasOwnProperty("dragTooltip")&&"object"==_typeof(this.options.map.dragTooltip)&&(this.options.map.dragTooltip.hasOwnProperty("active")||(this.options.map.dragTooltip.active=!0),this.options.map.dragTooltip.hasOwnProperty("text")||(this.options.map.dragTooltip.text="To drag map touch screen by two fingers and move")),this.options.map.hasOwnProperty("filterTooltip")||(this.options.map.filterTooltip={}),this.options.map.hasOwnProperty("filterTooltip")&&"object"==_typeof(this.options.map.filterTooltip)&&(this.options.map.filterTooltip.hasOwnProperty("active")||(this.options.map.filterTooltip.active=!0),this.options.map.filterTooltip.hasOwnProperty("text")||(this.options.map.filterTooltip.text="No matches found"))}if(this.options.hasOwnProperty("list")||(this.options.list={}),this.options.hasOwnProperty("list")&&"object"==_typeof(this.options.list)){if(this.options.list.hasOwnProperty("active")||(this.options.list.active=!1),this.options.list.hasOwnProperty("active")&&this.options.list.active&&!this.options.list.hasOwnProperty("container"))throw new Error("You need to set container option in list");this.options.list.hasOwnProperty("scroll")||(this.options.list.scroll=!1),this.options.list.hasOwnProperty("header")||(this.options.list.header=!0),this.options.list.hasOwnProperty("clickElement")||(this.options.list.clickElement=this.listClassName+"__title"),this.options.list.hasOwnProperty("itemWrapper")||(this.options.list.itemWrapper=!1),this.options.list.hasOwnProperty("modifier")||(this.options.list.modifier="")}this.options.hasOwnProperty("switchContainer")||(this.options.switchContainer=!1),this.options.hasOwnProperty("cluster")||(this.options.cluster={}),this.options.hasOwnProperty("cluster")&&"object"==_typeof(this.options.cluster)&&(this.options.cluster.hasOwnProperty("icons")||(this.options.cluster.icons=["islands#invertedRedClusterIcons","islands#invertedBlueClusterIcons"]),this.options.cluster.hasOwnProperty("inlineStyle")||(this.options.cluster.inlineStyle="")),this.options.hasOwnProperty("placemark")||(this.options.placemark={}),this.options.hasOwnProperty("placemark")&&"object"==_typeof(this.options.placemark)&&(this.options.placemark.hasOwnProperty("icons")||(this.options.placemark.icons=["islands#redDotIcon","islands#blueDotIcon"]),this.options.placemark.hasOwnProperty("clicked")||(this.options.placemark.clicked=!0)),this.options.hasOwnProperty("balloon")||(this.options.balloon={}),this.options.hasOwnProperty("balloon")&&"object"==_typeof(this.options.balloon)&&(this.options.balloon.hasOwnProperty("activeBeforeBreakpoint")||(this.options.balloon.activeBeforeBreakpoint=!1),this.options.balloon.hasOwnProperty("activeAfterBreakpoint")||(this.options.balloon.activeAfterBreakpoint=!1),this.options.balloon.hasOwnProperty("closeButton")||(this.options.balloon.closeButton="x"),this.options.balloon.hasOwnProperty("header")||(this.options.balloon.header=!0),this.options.balloon.hasOwnProperty("mapOverflow")||(this.options.balloon.mapOverflow=!0),this.options.balloon.hasOwnProperty("modifier")||(this.options.balloon.modifier="")),this.options.hasOwnProperty("adaptiveBreakpoint")||(this.options.adaptiveBreakpoint=1024)}},{key:"_initMap",value:function(){var t=this;this.map&&(this.map.destroy(),this.map=null,this.placemarks=[],this.activePlacemark=null,this.clusterer=null,this.balloonLayout=null),this.options.map.dragTooltip.active&&this._initMapDragTooltip();var o={center:this.options.map.center,zoom:13,controls:[]},e=null;"object"==_typeof(this.options.map.customize)&&"object"==_typeof(this.options.map.customize.state)&&(e=this._setMapState(this.options.map.customize.state,o)),this.map=new ymaps.Map(this.options.map.container,e||o,this.options.map.customize.options),"object"==_typeof(this.options.map.customize)&&"object"==_typeof(this.options.map.customize.controls)&&this._setMapControls(this.options.map.customize.controls),this.map.behaviors.disable("scrollZoom"),this._createPlacemarks(),"boolean"!=typeof this.options.cluster||this.options.cluster?(this._createClusterer(),this._addClusterer(),this._setBounds(this.clusterer)):(this._addPlacemarks(),this._setBounds(this.map.geoObjects)),(this.touch&&this.options.map.drag.disableOnTouch||this.options.map.drag.disableAlways)&&this.map.behaviors.disable("drag");var i=this.map.layers.get(0).get(0);this._isReadyMap(i).then(function(){var o=t.options.balloon.activeBeforeBreakpoint,e=t.options.balloon.activeAfterBreakpoint;t.activeListItem&&(t.options.placemark.clicked&&o&&t.isLessThanAdaptiveBreakpoint||t.options.placemark.clicked&&e&&!t.isLessThanAdaptiveBreakpoint)&&t._openPlacemarkBalloon(t.activeListItem)}),this.needReloadMap=!1}},{key:"_destroyMap",value:function(){this.map&&(this.map.destroy(),this.map=null,this.placemarks=[],this.activePlacemark=null,this.clusterer=null,this.balloonLayout=null)}},{key:"_isReadyMap",value:function(t){return new ymaps.vow.Promise(function(o,e){var i=function(t){for(var o in t)if(t.hasOwnProperty(o)&&(t[o]instanceof ymaps.layer.tileContainer.CanvasContainer||t[o]instanceof ymaps.layer.tileContainer.DomContainer))return t[o];return null}(t),s=!0;i.tiles.each(function(t,o){t.isReady()||(s=!1)}),s?o():i.events.once("ready",function(){o()})})}},{key:"_initList",value:function(){this._createPointsList()}},{key:"_initMapDragTooltip",value:function(){var t=this,o=$("#"+this.options.map.container),e=$('<div class="ylist-drag-tooltip">\n                              <span class="ylist-drag-tooltip__text">'+this.options.map.dragTooltip.text+"</span>\n                          </div>");o.find(".ylist-drag-tooltip").remove(),o.append(e),o.off("touchmove touchstart touchend touchleave touchcancel"),(this.touch&&this.options.map.drag.disableOnTouch||this.options.map.drag.disableAlways)&&o.on("touchmove",function(o){1==o.originalEvent.touches.length?(e.css("opacity","1"),!t.options.balloon.mapOverflow&&t.activePlacemark&&t.activePlacemark.balloon.close()):e.css("opacity","0")}).on("touchstart touchend touchleave touchcancel",function(t){e.css("opacity","0")})}},{key:"_setMapState",value:function(t,o){return Object.assign({},o,t)}},{key:"_setMapControls",value:function(t){var o=this;t.forEach(function(t){var e={};if(!t.hasOwnProperty("constructor"))throw new Error("Нужно указать название метода-конструктора. Например:\nhttps://tech.yandex.ru/maps/doc/jsapi/2.1/ref/reference/control.FullscreenControl-docpage/");e.options=t.options,o.map.controls.add(new ymaps.control[t.constructor](e))})}},{key:"_createPlacemarks",value:function(){for(var t=this,o=0;o<this.points.length;o++){var e=void 0,i=this.options.balloon.activeBeforeBreakpoint,s=this.options.balloon.activeAfterBreakpoint;e=i&&s&&this.options.placemark.clicked||i&&this.isLessThanAdaptiveBreakpoint&&this.options.placemark.clicked||s&&!this.isLessThanAdaptiveBreakpoint&&this.options.placemark.clicked?this._setBalloonData(o):{};var a=this.points[o],n=new ymaps.Placemark(a.coords,e,this._setPlacemarkOptions(o));n.id=a.id,n.events.add("click",function(o){t._placemarkClickHandler(o,t)}),this.activeListItem&&this.activeListItem==a.id&&("string"==typeof this.options.placemark.icons[0]?n.options.set("preset",this.options.placemark.icons[1]):n.options.set("iconImageHref",this.options.placemark.icons[1].href),n.isActive=!0,n.options.set("zIndex",1e3)),this.placemarks.push(n)}}},{key:"_addPlacemarks",value:function(){for(var t=0;t<this.placemarks.length;t++)this.map.geoObjects.add(this.placemarks[t])}},{key:"_openPlacemarkBalloon",value:function(t){for(var o=0;o<this.placemarks.length;o++){var e=this.placemarks[o];if(e.id==t){e.events.fire("click");break}}}},{key:"_setPlacemarkOptions",value:function(t){var o={},e=this.options.balloon.activeBeforeBreakpoint,i=this.options.balloon.activeAfterBreakpoint;return"string"==typeof this.options.placemark.icons[0]?o.preset=this.options.placemark.icons[0]:(o.iconLayout="default#image",o.iconImageHref=this.options.placemark.icons[0].href,o.iconImageSize=this.options.placemark.icons[0].size,o.iconImageOffset=this.options.placemark.icons[0].offset),(e&&i&&this.options.placemark.clicked||e&&this.isLessThanAdaptiveBreakpoint&&this.options.placemark.clicked||i&&!this.isLessThanAdaptiveBreakpoint&&this.options.placemark.clicked)&&(o.balloonLayout=this._createBalloonLayout(),o.balloonContentLayout=this._createBalloonContentLayout(),o.balloonAutoPan=!1,o.balloonShadow=!1,o.balloonPanelMaxMapArea=0),this.options.placemark.clicked||(o.cursor="default"),o}},{key:"_createClusterer",value:function(){if(this.clusterer&&this.clusterer.removeAll(),this.clusterer=new ymaps.Clusterer({groupByCoordinates:!1,clusterDisableClickZoom:!1,clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1,zoomMargin:40}),"string"==typeof this.options.cluster.icons[0])this.clusterer.options.set({preset:this.options.cluster.icons[0]});else{var t=ymaps.templateLayoutFactory.createClass('<div style="'+this.options.cluster.inlineStyle+'">{{ properties.geoObjects.length }}</div>');this.clusterer.options.set({clusterIcons:this.options.cluster.icons[0],clusterNumbers:[100],clusterIconContentLayout:t})}this.clusterer.add(this.placemarks)}},{key:"_addClusterer",value:function(){this.map.geoObjects.add(this.clusterer)}},{key:"_createBalloonLayout",value:function(){var t=this;return ymaps.templateLayoutFactory.createClass('<div class="ylist-balloon '+this.options.balloon.modifier+'">\n                <button class="ylist-balloon__close" type="button">'+this.options.balloon.closeButton+'</button>\n                <div class="ylist-balloon__inner">\n                    $[[options.contentLayout]]\n                </div>\n            </div>',{build:function(){this.constructor.superclass.build.call(this),this._$element=$(".ylist-balloon",this.getParentElement()),this.applyElementOffset(),this._$element.find(".ylist-balloon__close").on("click",$.proxy(this.onCloseClick,this)),t.balloonParams.balloonWidth=this._$element[0].offsetWidth,t.balloonParams.balloonHeight=this._$element[0].offsetHeight+t.balloonParams.balloonTailHeight},clear:function(){this._$element.find(".ylist-balloon__close").off("click"),this.constructor.superclass.clear.call(this)},onSublayoutSizeChange:function(){this.balloonLayout.superclass.onSublayoutSizeChange.apply(this,arguments),this._isElement(this._$element)&&(this.applyElementOffset(),this.events.fire("shapechange"))},applyElementOffset:function(){this._$element.css({left:-this._$element[0].offsetWidth/2,top:-(this._$element[0].offsetHeight+t.balloonParams.balloonTailHeight)})},onCloseClick:function(t){t.preventDefault(),this.events.fire("userclose")},_isElement:function(t){return t&&t[0]&&t.find(".ylist-balloon__inner")[0]}})}},{key:"_createBalloonContentLayout",value:function(){var t="";return t=!1===this.options.balloon.header?'<div class="ylist-balloon__content">$[properties.balloonContent]</div>':'<h3 class="ylist-balloon__title">$[properties.balloonHeader]</h3>\n                                    <div class="ylist-balloon__content">$[properties.balloonContent]</div>',ymaps.templateLayoutFactory.createClass(t)}},{key:"_setBalloonData",value:function(t){for(var o="",e="",i=0;i<this.options.dataOrder.length;i++){var s=this.options.dataOrder[i],a="",n="";this.options.dataExtension.hasOwnProperty(s)&&"name"!=s?n=this.options.dataExtension[s](this.points[t][s],this.points[t]):this.options.dataExtension.hasOwnProperty(s)&&"name"==s?a=this.options.dataExtension[s](this.points[t][s],this.points[t]):(a=this.points[t].name,n=this.points[t][s]),o+=a,e+=n}return{balloonHeader:o,balloonContent:e}}},{key:"_setBalloonPane",value:function(t,o,e){e=e||{globalPixelCenter:t.getGlobalPixelCenter(),zoom:t.getZoom()};var i=t.container.getSize(),s=[[e.globalPixelCenter[0]-i[0]/2,e.globalPixelCenter[1]-i[1]/2],[e.globalPixelCenter[0]+i[0]/2,e.globalPixelCenter[1]+i[1]/2]],a=o.balloon.getPosition(),n=Math.pow(2,e.zoom-t.getZoom()),l=ymaps.util.pixelBounds.containsPoint(s,[a[0]*n,a[1]*n]),r="outerBalloon"==o.options.get("balloonPane");!l&&r?o.options.set({balloonPane:"balloon",balloonShadowPane:"shadows"}):l&&!r&&o.options.set({balloonPane:"outerBalloon",balloonShadowPane:"outerBalloon"})}},{key:"_createListElement",value:function(t){var o=$("<h3/>",{class:this.listClassName+"__title"}),e="",i="",s=$("<li/>",{id:t.id,class:this.listClassName+"__item"});t.name&&this.options.list.header?this.options.dataExtension.hasOwnProperty("name")?o.html(this.options.dataExtension.name(t.name,t)):o.html(t.name):o=null;for(var a=0;a<this.options.dataOrder.length;a++){var n=this.options.dataOrder[a],l="";this.options.dataExtension.hasOwnProperty(n)&&"name"!=n?l=this.options.dataExtension[n](t[n],t):"name"!=n&&(l=t[n]),e+=l}return!1!==this.options.list.itemWrapper?((i=$("<div/>",{class:this.options.list.itemWrapper})).append(o,e),s.append(i)):s.append(o,e),s}},{key:"_createPointsList",value:function(){for(var t=this,o=$("<ul/>",{class:this.listClassName+" "+this.options.list.modifier}),e=0;e<this.points.length;e++){var i=this.points[e];o.append(this._createListElement(i))}$("#"+this.options.list.container).html("").append(o),$(document).on("click","."+t.options.list.clickElement,function(o){var e=$(this).closest("."+t.listClassName+"__item").attr("id");if(t.placemarks.length>0)for(var i=0;i<t.placemarks.length;i++){var s=t.placemarks[i];if(s.id==e){t._listItemClickHandler(o,s);break}}else t._listItemClickHandler(o,e)})}},{key:"_setBounds",value:function(t){"object"===_typeof(this.placemarks)&&1===this.placemarks.length?this.map.setCenter(this.placemarks[0].geometry.getCoordinates(),16):this.map.setBounds(t.getBounds(),{checkZoomRange:!0,zoomMargin:10})}},{key:"_placemarkClickHandler",value:function(t,o){if(this.options.placemark.clicked){var e=t.get("target"),i=this.options.balloon.activeBeforeBreakpoint,s=this.options.balloon.activeAfterBreakpoint;if(o.activePlacemark=e,this._commonClickHandler(e),i&&s||i&&!s&&this.isLessThanAdaptiveBreakpoint||!i&&s&&!this.isLessThanAdaptiveBreakpoint){if(!1===this.options.balloon.mapOverflow){var a=function(t){"outerBalloon"===e.options.get("balloonPane")&&o._setBalloonPane(o.map,e,t.get("tick"))},n=function(t){"outerBalloon"!==e.options.get("balloonPane")&&o._setBalloonPane(o.map,e,t.get("tick"))};o.map.geoObjects.events.add("balloonopen",function(){o.map.events.add("actiontick",a),o.map.events.add("actiontickcomplete",n),o._setBalloonPane(o.map,e)}),o.map.geoObjects.events.add("balloonclose",function(){o.map.events.remove("actiontick",a),o.map.events.remove("actiontickcomplete",n)})}o.map.geoObjects.events.add("balloonopen",function t(){var i,s=void 0,a=!1===o.options.balloon.mapOverflow?4:2;(s=o.map.options.get("projection").toGlobalPixels(e.geometry.getCoordinates(),o.map.getZoom()))[1]-=o.balloonParams.balloonHeight/a,i=o.map.options.get("projection").fromGlobalPixels(s,o.map.getZoom()),o.map.panTo(i,{flying:!0}),o.map.geoObjects.events.remove("balloonopen",t)})}else o.map.panTo(e.geometry.getCoordinates(),{flying:!0})}}},{key:"_listItemClickHandler",value:function(t,o){this._commonClickHandler(o);var e=this.options.balloon.activeBeforeBreakpoint,i=this.options.balloon.activeAfterBreakpoint;if("string"!=typeof o){if(this.activePlacemark&&this.map.getZoom()<11){var s=this.clusterer.getObjectState(this.activePlacemark).isClustered,a=this.clusterer.getObjectState(o).isClustered,n=(ymaps.coordSystem.geo.getDistance(o.geometry.getCoordinates(),this.activePlacemark.geometry.getCoordinates()),null);if(!s&&!a)return n=!0,this.map.panTo(o.geometry.getCoordinates(),{flying:n}).then(function(){console.log("flying")}),this.activePlacemark=o,void(this.options.list.active&&this.options.placemark.clicked&&i&&!this.isLessThanAdaptiveBreakpoint&&o.events.fire("click"))}for(var l=9===this.map.getZoom()?this.map.getZoom():9;this.map.setCenter(o.geometry.getCoordinates(),l++),this.clusterer.getObjectState(o).isClustered;);this.activePlacemark=o,(this.options.placemark.clicked&&e&&i||this.options.placemark.clicked&&e&&!i&&this.isLessThanAdaptiveBreakpoint||this.options.placemark.clicked&&!e&&i&&!this.isLessThanAdaptiveBreakpoint)&&o.events.fire("click")}}},{key:"_commonClickHandler",value:function(t){var o=null,e=null,i=null,s=this.options.list.active;if(s&&(o=$("#"+this.options.list.container)),"string"==typeof t)s&&(e=$("#"+t)),i=t;else{s&&(e=$("#"+t.id)),i=t.id;for(var a=0;a<this.placemarks.length;a++){var n=this.placemarks[a];"string"==typeof this.options.placemark.icons[0]?n.options.set("preset",this.options.placemark.icons[0]):n.options.set("iconImageHref",this.options.placemark.icons[0].href),n.balloon.close(),this.clusterer.getObjectState(n).cluster&&("string"==typeof this.options.cluster.icons[0]?this.clusterer.getObjectState(n).cluster.options.set("preset",this.options.cluster.icons[0]):this.clusterer.getObjectState(n).cluster.options.set("clusterIcons",this.options.cluster.icons[0])),n.isActive=!1,n.options.set("zIndex",650)}t.options.set("zIndex",1e3),this.clusterer.getObjectState(t).isClustered&&("string"==typeof this.options.cluster.icons[0]?this.clusterer.getObjectState(t).cluster.options.set("preset",this.options.cluster.icons[1]):this.clusterer.getObjectState(t).cluster.options.set("clusterIcons",this.options.cluster.icons[1])),"string"==typeof this.options.placemark.icons[0]?t.options.set("preset",this.options.placemark.icons[1]):t.options.set("iconImageHref",this.options.placemark.icons[1].href),t.isActive=!0}this.activeListItem=i,s&&(o.find("."+this.listClassName+"__item.is-active").removeClass("is-active"),e.addClass("is-active"),"boolean"!=typeof this.options.list.scroll||this.options.list.scroll?this.options.list.scroll(o,e):o.scrollTop(e.position().top+o.scrollTop()))}},{key:"_adaptiveHandle",value:function(t,o){var e=o.options.list.active;t.matches?(o.isLessThanAdaptiveBreakpoint=!0,o.needReloadMap=!0,e&&o._destroyMap(),0!=o.options.switchContainer&&($("#"+o.options.switchContainer).addClass("is-visible"),$("#"+o.options.switchContainer).find('[data-ylist-switch="list"]').addClass("is-active")),e&&$("#"+o.options.map.container).addClass("is-hidden"),$("#"+o.options.map.container).addClass("is-adaptive"),$("#"+o.options.list.container).addClass("is-adaptive"),$("#"+o.options.container).addClass("is-adaptive"),e||o.map||o._initMap(),$(document).on("click","#"+o.options.switchContainer+" [data-ylist-switch]",function(t){o._switchHandler(t,o)})):(o.isLessThanAdaptiveBreakpoint=!1,0!=o.options.switchContainer&&($("#"+o.options.switchContainer).removeClass("is-visible"),$("#"+o.options.switchContainer).find("[data-ylist-switch]").removeClass("is-active")),$("#"+o.options.map.container).removeClass("is-adaptive is-hidden"),$("#"+o.options.list.container).removeClass("is-adaptive is-hidden"),$("#"+o.options.container).removeClass("is-adaptive"),!e&&(e||o.isLessThanAdaptiveBreakpoint||o.map)||(o._initMap(),this.currentFilterCallback&&this.currentFilterParam&&o.filter(this.currentFilterCallback,this.currentFilterParam)),$(document).off("click","#"+o.options.switchContainer+" [data-ylist-switch]",o._switchHandler)),o.map&&(o.touch&&o.options.map.drag.disableOnTouch||o.options.map.drag.disableAlways?o.map.behaviors.disable("drag"):o.map.behaviors.enable("drag"),o.options.map.dragTooltip.active&&o._initMapDragTooltip())}},{key:"_switchHandler",value:function(t,o){var e=$(t.target),i=this.options.balloon.activeBeforeBreakpoint;this.options.balloon.activeAfterBreakpoint;e.length&&!e.hasClass("is-active")&&("map"===e.attr("data-ylist-switch")?($("#"+o.options.map.container).removeClass("is-hidden"),$("#"+o.options.list.container).addClass("is-hidden"),o.needReloadMap?(o._initMap(),this.currentFilterCallback&&this.currentFilterParam&&o.filter(this.currentFilterCallback,this.currentFilterParam)):o.options.list.active&&o.activeListItem&&o.options.placemark.clicked&&i&&o.isLessThanAdaptiveBreakpoint&&o._openPlacemarkBalloon(o.activeListItem)):"list"===e.attr("data-ylist-switch")&&($("#"+o.options.map.container).addClass("is-hidden"),$("#"+o.options.list.container).removeClass("is-hidden")),$("#"+o.options.switchContainer+" [data-ylist-switch]").removeClass("is-active"),e.addClass("is-active"))}},{key:"filter",value:function(t,o){var e=this;if("function"!=typeof t)throw new TypeError("Аргумент должен быть функцией");this.currentFilterCallback=t;var i=this.points,s=this.placemarks,a=0,n=$('<div class="ylist-filter-tooltip">\n                                    <span class="ylist-filter-tooltip__text">'+this.options.map.filterTooltip.text+"</span>\n                                </div>");if(!this.map||s.length){this.map?s.forEach(function(t){t.options.set("visible",!1),e.clusterer.remove(t),$("#"+t.id).hide()}):$("#"+this.options.list.container+" ."+this.listClassName+"__item").hide();for(var l=0;l<i.length;l++){var r=i[l];t(r,l,i)?(this.map&&(s[l].options.set("visible",!0),this.clusterer.add(s[l])),$("#"+r.id).show(),this.currentFilterParam=o):a++}a==i.length?this.options.map.filterTooltip.active?($("#"+this.options.container+" .ylist-filter-tooltip").remove(),$("#"+this.options.container).append(n),$("#"+this.options.container+" .ylist-filter-tooltip").css("opacity","1")):console.warn(this.options.map.filterTooltip.text):(this.options.map.filterTooltip.active&&$("#"+this.options.container+" .ylist-filter-tooltip").remove(),"boolean"!=typeof this.options.cluster||this.options.cluster?this._setBounds(this.clusterer):this._setBounds(this.map.geoObjects))}else console.warn("Невозможно запустить фильтрацию. Массив меток пуст.")}},{key:"clearFilter",value:function(){var t=this;this.currentFilterCallback=null,this.currentFilterParam=null,this.options.map.filterTooltip.active&&$("#"+this.options.container+" .ylist-filter-tooltip").remove();for(var o=this.points,e=this.placemarks,i=0;i<o.length;i++)this.map?(e.forEach(function(o){o.options.set("visible",!0),t.clusterer.add(o),$("#"+o.id).show()}),"boolean"!=typeof this.options.cluster||this.options.cluster?this._setBounds(this.clusterer):this._setBounds(this.map.geoObjects)):$("#"+this.options.list.container+" ."+this.listClassName+"__item").show()}}]),t}();